<!DOCTYPE html>
<html>
<head>
  <title>Stats Joueur</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 30px auto; }
    input { padding: 8px; font-size: 16px; width: 70%; }
    button { padding: 8px 16px; font-size: 16px; }
    pre { background: #f4f4f4; padding: 10px; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>Voir les statistiques d’un joueur</h1>
  <input type="text" id="pseudo" placeholder="Entrez le pseudo" />
  <button onclick="getStats()">Voir stats</button>

  <div id="stats" style="margin-top: 20px;"></div>

  <script>
    
    const firebaseConfig = {
      apiKey: "AIzaSyCZBqPeA51GZcNuIU3ujqnPJec98Q9SWcI",
      authDomain: "vaultofpain-93144.firebaseapp.com",
      databaseURL: "https://vaultofpain-93144-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "vaultofpain-93144",
      storageBucket: "vaultofpain-93144.firebasestorage.app",
      messagingSenderId: "175940463844",
      appId: "1:175940463844:web:e100d2f9849e2e1e9190f1"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function formatCapacites(capacites) {
      let result = '';
      for (const [nom, data] of Object.entries(capacites)) {
        const nomLisible = nom.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
        const actif = data.actif ? 'Oui' : 'Non';
        result += `${nomLisible} : Niveau ${data.niveau}, Actif : ${actif}\n`;
      }
      return result;
    }

    function formatStatChoisi(statString) {
      const labels = ['PV', 'Dégât', 'Vitesse Attaque', 'Défense', 'Mana'];
      const valeurs = statString.split(',').map(s => s.trim());
      let result = '';
      for (let i = 0; i < labels.length; i++) {
        result += `${labels[i]} : ${valeurs[i]}  `;
      }
      return result.trim();
    }

    function getStats() {
      const pseudo = document.getElementById('pseudo').value.trim();
      if (!pseudo) {
        alert('Merci d’entrer un pseudo');
        return;
      }

      const statsDiv = document.getElementById('stats');
      statsDiv.innerHTML = 'Chargement...';

      const ref = db.ref('utilisateurs/' + pseudo + '/profil');
      ref.get()
        .then(snapshot => {
          if (snapshot.exists()) {
            const profil = snapshot.val();

            statsDiv.innerHTML = `
              <h2>Stats de ${pseudo}</h2>
              <pre>Capacités :
${formatCapacites(profil.capacites)}</pre>
              
              <p>Map chargée : ${profil.map_charge}</p>
              <p>Niveau : ${profil.niv}</p>
              <p>XP : ${profil.xp}</p>
              
              <p>Stat choisi : ${formatStatChoisi(profil.stat_choisi)}</p>
              
            `;
          } else {
            statsDiv.innerHTML = 'Aucun profil trouvé pour ce joueur.';
          }
        })
        .catch(error => {
          console.error("Erreur récupération stats :", error);
          statsDiv.innerHTML = 'Erreur lors de la récupération des données.';
        });
    }
  </script>
</body>
</html>
